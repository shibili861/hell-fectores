<%- include('../partials/user/header') %>

<style>
@import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap');

:root {
  --primary: #003543;
  --secondary: #005566;
  --accent: #d4af37;
  --bg-soft: #f5f7f6;
  --card-bg: #ffffff;
  --text-dark: #1a1a1a;
  --text-muted: #6f7f86;
  --border-soft: rgba(0, 53, 67, 0.12);
  --shadow-soft: 0 8px 30px rgba(0, 53, 67, 0.06);
  --shadow-hover: 0 20px 40px rgba(0, 53, 67, 0.12);
  --gold-gradient: linear-gradient(135deg, #d4af37, #f7ef8a, #d4af37);
}

/* ================= BASE STYLES ================= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: var(--bg-soft);
  color: var(--text-dark);
  font-family: 'Montserrat', sans-serif;
  overflow-x: hidden;
}

/* ================= CONTAINER ALIGNMENT ================= */
.container-wrapper {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 40px;
}

/* ================= BREADCRUMB ================= */
.premium-breadcrumb {
  padding: 60px 0 20px;
  position: relative;
}

.breadcrumb-nav {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-muted);
}

.breadcrumb-nav a {
  color: var(--text-muted);
  text-decoration: none;
  transition: all 0.3s ease;
  position: relative;
  padding-bottom: 3px;
}

.breadcrumb-nav a:hover {
  color: var(--primary);
}

.breadcrumb-nav a:hover::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 1px;
  background: var(--gold-gradient);
}

.breadcrumb-separator {
  opacity: 0.5;
}

/* ================= HEADER ================= */
.wishlist-premium-header {
  padding: 30px 0 50px;
  position: relative;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--border-soft);
}

.title-section h1 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 52px;
  font-weight: 400;
  letter-spacing: 4px;
  color: var(--primary);
  margin-bottom: 8px;
  position: relative;
  display: inline-block;
}

.title-section h1::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 0;
  width: 60%;
  height: 2px;
  background: var(--gold-gradient);
}

.title-section .subtitle {
  font-size: 12px;
  letter-spacing: 3px;
  color: var(--text-muted);
  text-transform: uppercase;
}

.count-badge {
  background: var(--card-bg);
  padding: 8px 20px;
  border-radius: 30px;
  box-shadow: var(--shadow-soft);
  font-size: 11px;
  letter-spacing: 2px;
  color: var(--primary);
  border: 1px solid var(--border-soft);
}

/* ================= MAIN CONTENT ================= */
.wishlist-premium-content {
  padding-bottom: 120px;
  min-height: 50vh;
}

/* ================= PREMIUM TABLE ================= */
.premium-table-wrapper {
  background: var(--card-bg);
  border-radius: 20px;
  overflow: hidden;
  box-shadow: var(--shadow-soft);
  margin-bottom: 60px;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
}

.premium-table-wrapper:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.premium-table {
  width: 100%;
  border-collapse: collapse;
}

.table-header {
  background: linear-gradient(135deg, rgba(0, 53, 67, 0.03), rgba(0, 85, 102, 0.02));
}

.table-header th {
  padding: 26px 30px;
  text-align: left;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--primary);
  border-bottom: 1px solid var(--border-soft);
  position: relative;
}

.table-header th::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 30px;
  width: calc(100% - 60px);
  height: 1px;
  background: var(--gold-gradient);
  opacity: 0.3;
}

/* ================= TABLE ROWS ================= */
.table-row {
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  border-bottom: 1px solid rgba(0, 53, 67, 0.05);
}

.table-row:last-child {
  border-bottom: none;
}

.table-row:hover {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(245, 247, 246, 0.7));
  transform: translateX(10px);
}

.table-row td {
  padding: 30px;
  vertical-align: middle;
}

/* ================= PRODUCT COLUMN ================= */
.product-cell {
  display: flex;
  align-items: center;
  gap: 25px;
}

.product-image-container {
  width: 100px;
  height: 100px;
  border-radius: 16px;
  overflow: hidden;
  position: relative;
  box-shadow: 0 10px 25px rgba(0, 53, 67, 0.1);
  transition: all 0.5s ease;
}

.table-row:hover .product-image-container {
  transform: scale(1.08) rotate(2deg);
  box-shadow: 0 15px 35px rgba(0, 53, 67, 0.2);
}

.product-image-container img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.6s ease;
}

.table-row:hover .product-image-container img {
  transform: scale(1.15);
}

.product-info h3 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 24px;
  font-weight: 500;
  color: var(--primary);
  margin-bottom: 6px;
  letter-spacing: 1px;
}

.product-category {
  font-size: 10px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-muted);
}

/* ================= PRICE COLUMN ================= */
.price-cell {
  text-align: center;
}

.current-price {
  font-size: 24px;
  font-weight: 600;
  color: var(--primary);
  position: relative;
  display: inline-block;
}

.current-price::before {
  content: 'â‚¹';
  font-size: 16px;
  vertical-align: super;
  margin-right: 2px;
}

.original-price {
  font-size: 13px;
  color: var(--text-muted);
  text-decoration: line-through;
  margin-top: 5px;
}

/* ================= ACTIONS COLUMN ================= */
.actions-cell {
  min-width: 300px;
}

.actions-container {
  display: flex;
  align-items: center;
  gap: 15px;
}

/* Size Select Styling */
.premium-size-select {
  padding: 14px 24px;
  border-radius: 30px;
  border: 1.5px solid var(--border-soft);
  background: var(--card-bg);
  font-family: 'Montserrat', sans-serif;
  font-size: 12px;
  color: var(--primary);
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23003543' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 20px center;
  background-size: 12px;
  padding-right: 50px;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 150px;
}

.premium-size-select:hover {
  border-color: var(--accent);
  box-shadow: 0 5px 15px rgba(212, 175, 55, 0.2);
  transform: translateY(-2px);
}

.premium-size-select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
}

/* Add to Cart Button */
.premium-cart-btn {
  padding: 15px 32px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border: none;
  border-radius: 30px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
  display: flex;
  align-items: center;
  gap: 10px;
}

.premium-cart-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.7s ease;
}

.premium-cart-btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 15px 30px rgba(0, 53, 67, 0.3);
}

.premium-cart-btn:hover::before {
  left: 100%;
}

.premium-cart-btn:active {
  transform: translateY(-1px) scale(1.02);
}

/* Delete Button */
.premium-delete-btn {
  width: 46px;
  height: 46px;
  border-radius: 50%;
  background: rgba(0, 53, 67, 0.05);
  border: 1.5px solid var(--border-soft);
  color: var(--primary);
  font-size: 20px;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  display: flex;
  align-items: center;
  justify-content: center;
}

.premium-delete-btn:hover {
  background: linear-gradient(135deg, #ff6b6b, #ff4757);
  border-color: #ff4757;
  color: white;
  transform: rotate(90deg) scale(1.1);
  box-shadow: 0 10px 20px rgba(255, 71, 87, 0.3);
}

/* ================= EMPTY STATE ================= */
.empty-wishlist-state {
  text-align: center;
  padding: 100px 40px;
  background: var(--card-bg);
  border-radius: 24px;
  box-shadow: var(--shadow-soft);
  margin: 40px 0;
}

.empty-icon-wrapper {
  width: 120px;
  height: 120px;
  background: linear-gradient(135deg, rgba(0, 53, 67, 0.05), rgba(0, 85, 102, 0.03));
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 40px;
  position: relative;
}

.empty-icon-wrapper::after {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: 50%;
  background: var(--gold-gradient);
  opacity: 0.3;
  z-index: -1;
}

.empty-icon {
  font-size: 48px;
  color: var(--primary);
  opacity: 0.4;
}

.empty-content h3 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 36px;
  color: var(--primary);
  margin-bottom: 16px;
  letter-spacing: 2px;
}

.empty-content p {
  font-size: 16px;
  color: var(--text-muted);
  line-height: 1.6;
  max-width: 500px;
  margin: 0 auto 40px;
}

/* Explore Collection Button */
.premium-explore-btn {
  padding: 18px 45px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border: none;
  border-radius: 35px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  text-decoration: none;
  display: inline-block;
  position: relative;
  overflow: hidden;
}

.premium-explore-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.7s ease;
}

.premium-explore-btn:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 20px 40px rgba(0, 53, 67, 0.4);
}

.premium-explore-btn:hover::before {
  left: 100%;
}

/* ================= CONTINUE SHOPPING ================= */
.continue-shopping-section {
  text-align: center;
  padding: 60px 40px;
  background: linear-gradient(135deg, rgba(0, 53, 67, 0.02), rgba(0, 85, 102, 0.01));
  border-radius: 24px;
  margin-top: 40px;
}

.continue-shopping-section h3 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 32px;
  color: var(--primary);
  margin-bottom: 16px;
  letter-spacing: 2px;
}

.continue-shopping-section p {
  font-size: 15px;
  color: var(--text-muted);
  line-height: 1.6;
  max-width: 500px;
  margin: 0 auto 40px;
}

/* ================= RESPONSIVE DESIGN ================= */
@media (max-width: 1200px) {
  .container-wrapper {
    padding: 0 30px;
  }
  
  .table-row td {
    padding: 25px 20px;
  }
}

@media (max-width: 992px) {
  .premium-table {
    display: block;
  }
  
  .table-header {
    display: none;
  }
  
  .table-row {
    display: block;
    margin-bottom: 30px;
    border: 1px solid var(--border-soft);
    border-radius: 16px;
    padding: 25px;
  }
  
  .table-row td {
    display: block;
    padding: 15px 0;
    border: none;
  }
  
  .product-cell {
    flex-direction: column;
    text-align: center;
    gap: 20px;
  }
  
  .actions-container {
    justify-content: center;
    flex-wrap: wrap;
  }
}

@media (max-width: 768px) {
  .container-wrapper {
    padding: 0 20px;
  }
  
  .title-section h1 {
    font-size: 40px;
  }
  
  .header-content {
    flex-direction: column;
    align-items: flex-start;
    gap: 20px;
  }
  
  .premium-cart-btn,
  .premium-explore-btn {
    padding: 16px 30px;
    font-size: 11px;
  }
  
  .empty-content h3 {
    font-size: 28px;
  }
}

@media (max-width: 480px) {
  .title-section h1 {
    font-size: 32px;
    letter-spacing: 2px;
  }
  
  .product-info h3 {
    font-size: 20px;
  }
  
  .premium-size-select {
    min-width: 120px;
    padding: 12px 20px;
  }
}
.wishlist-page {
  padding-top: 75px;
}

</style>

<div class="wishlist-page">
<!-- Premium Header -->
<div class="container-wrapper">
    <div class="wishlist-premium-header">
        <div class="header-content">
            <div class="title-section">
                <h1>Wishlist</h1>
                <p class="subtitle">YOUR CURATED SELECTION</p>
            </div>
            <% if (wishlist.products && wishlist.products.length > 0) { %>
                <div class="count-badge">
                    <%= wishlist.products.length %> <%= wishlist.products.length === 1 ? 'ITEM' : 'ITEMS' %>
                </div>
            <% } %>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container-wrapper">
    <div class="wishlist-premium-content">
        <% if (!wishlist.products || wishlist.products.length === 0) { %>
            <!-- Premium Empty State -->
            <div class="empty-wishlist-state">
                <div class="empty-icon-wrapper">
                    <div class="empty-icon">â™¡</div>
                </div>
                <div class="empty-content">
                    <h3>Your Wishlist Awaits</h3>
                    <p>Discover our exclusive collection and save your favorite pieces for later. Your curated wishlist will appear here.</p>
                    <a href="/collections" class="premium-explore-btn">
                        <span>Explore Collection</span>
                    </a>
                </div>
            </div>
        <% } else { %>
            <!-- Premium Table -->
            <div class="premium-table-wrapper">
                <table class="premium-table">
                    <thead class="table-header">
                        <tr>
                            <th>Product</th>
                            <th>Details</th>
                            <th>Price</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% wishlist.products.forEach((item, index) => { %>
                            <% const p = item.productId; %>
                            <tr class="table-row" data-id="<%= p._id %>" style="animation-delay: <%= index * 0.1 %>s;">
                                <!-- Product Image -->
                                <td class="product-cell">
                                    <div class="product-image-container">
                                        <img src="<%= p.productImage[0] %>" alt="<%= p.productName %>" loading="lazy">
                                    </div>
                                </td>

                                <!-- Product Details -->
                                <td class="product-details">
                                    <div class="product-info">
                                        <h3><%= p.productName %></h3>
                                        <div class="product-category"><%= p.category || 'Premium Collection' %></div>
                                    </div>
                                </td>

                                <!-- Price -->
                                <td class="price-cell">
                                    <div class="current-price"><%= p.salePrice || p.regularPrice %></div>
                                    <% if (p.salePrice && p.regularPrice && p.salePrice < p.regularPrice) { %>
                                        <div class="original-price">â‚¹<%= p.regularPrice %></div>
                                    <% } %>
                                </td>

                                <!-- Actions -->
                                <td class="actions-cell">
                                    <div class="actions-container">
                                        <select class="premium-size-select" id="size-<%= p._id %>">
                                            <option value="">Select Size</option>
                                            <% if (p.sizeVariants && p.sizeVariants.length > 0) { %>
                                                <% p.sizeVariants.forEach(size => { %>
                                                    <option value="<%= size.size %>" <%= size.quantity > 0 ? "" : "disabled" %>>
                                                        <%= size.size %> <%= size.quantity > 0 ? "" : "(Out of Stock)" %>
                                                    </option>
                                                <% }) %>
                                            <% } else { %>
                                                <option value="Default">Default</option>
                                            <% } %>
                                        </select>

                                        <button class="premium-cart-btn" onclick="addToCartFromWishlist('<%= p._id %>')">
                                            <span class="cart-icon">ðŸ›’</span>
                                            <span>Add to Cart</span>
                                        </button>

                                        <button class="premium-delete-btn" onclick="removeFromWishlist('<%= p._id %>')" title="Remove from Wishlist">
                                            Ã—
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

            <!-- Continue Shopping Section -->
            <div class="continue-shopping-section">
                <h3>Continue Your Journey</h3>
                <p>Discover more exquisite pieces to complement your collection and elevate your personal style.</p>
                <a href="/collections" class="premium-explore-btn">
                    <span>View New Arrivals</span>
                </a>
            </div>
        <% } %>
    </div>
</div>
</div>
<script>
// Toast Notification Function
function showToast(message, type = 'success') {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `premium-toast ${type}`;
    toast.innerHTML = `
        <div class="toast-icon">${type === 'success' ? 'âœ“' : 'âœ•'}</div>
        <div class="toast-message">${message}</div>
    `;
    
    // Add styles if not already added
    if (!document.querySelector('#toast-styles')) {
        const styles = document.createElement('style');
        styles.id = 'toast-styles';
        styles.textContent = `
            .premium-toast {
                position: fixed;
                top: 30px;
                right: 30px;
                background: var(--card-bg);
                color: var(--primary);
                padding: 18px 25px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0, 53, 67, 0.15);
                display: flex;
                align-items: center;
                gap: 15px;
                z-index: 10000;
                transform: translateX(150%);
                transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                border-left: 4px solid;
                min-width: 300px;
            }
            .premium-toast.success {
                border-left-color: #00b894;
                background: linear-gradient(135deg, #ffffff, #f8fffd);
            }
            .premium-toast.error {
                border-left-color: #ff6b6b;
                background: linear-gradient(135deg, #ffffff, #fff8f8);
            }
            .toast-icon {
                width: 28px;
                height: 28px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 14px;
            }
            .success .toast-icon {
                background: #00b894;
                color: white;
            }
            .error .toast-icon {
                background: #ff6b6b;
                color: white;
            }
            .toast-message {
                font-size: 14px;
                font-weight: 500;
                letter-spacing: 0.5px;
            }
        `;
        document.head.appendChild(styles);
    }
    
    document.body.appendChild(toast);
    
    // Animate in
    setTimeout(() => {
        toast.style.transform = 'translateX(0)';
    }, 10);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        toast.style.transform = 'translateX(150%)';
        setTimeout(() => {
            toast.remove();
        }, 500);
    }, 3000);
}

// Add to Cart from Wishlist
async function addToCartFromWishlist(productId) {
    const sizeSelect = document.getElementById(`size-${productId}`);
    const size = sizeSelect?.value;

    if (!size || size === "") {
        showToast("Please select a size to continue", "error");
        
        // Add shake animation to size select
        sizeSelect.classList.add('shake');
        setTimeout(() => sizeSelect.classList.remove('shake'), 500);
        
        // Add shake animation styles
        if (!document.querySelector('#shake-styles')) {
            const styles = document.createElement('style');
            styles.id = 'shake-styles';
            styles.textContent = `
                .shake {
                    animation: shake 0.5s ease-in-out;
                }
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                    20%, 40%, 60%, 80% { transform: translateX(5px); }
                }
            `;
            document.head.appendChild(styles);
        }
        
        return;
    }

    try {
        const res = await fetch("/api/cart/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ productId, quantity: 1, size })
        });

        const data = await res.json();
        showToast(data.message, data.success ? "success" : "error");

        if (data.success) {
            // Remove item from wishlist after successful add to cart
            await removeFromWishlist(productId);
        }
    } catch (error) {
        console.error('Error adding to cart:', error);
        showToast("Failed to add item to cart. Please try again.", "error");
    }
}

// Remove from Wishlist
async function removeFromWishlist(productId) {
    try {
        const row = document.querySelector(`tr[data-id="${productId}"]`);
        
        // Add fade out animation
        if (row) {
            row.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            row.style.opacity = '0';
            row.style.transform = 'translateX(-50px) scale(0.95)';
        }

        const res = await fetch("/wishlist/remove", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ productId })
        });

        const data = await res.json();
        showToast(data.message, data.success ? "success" : "error");

        if (data.success && row) {
            // Wait for animation to complete before removing
            setTimeout(() => {
                row.remove();
                
                // Check if wishlist is now empty
                const remainingRows = document.querySelectorAll('.table-row').length;
                if (remainingRows === 0) {
                    // Reload page to show empty state
                    setTimeout(() => window.location.reload(), 300);
                }
                
                // Update navbar wishlist count
                updateWishlistNavbar();
            }, 500);
        }
    } catch (error) {
        console.error('Error removing from wishlist:', error);
        showToast("Failed to remove item from wishlist. Please try again.", "error");
    }
}

// Update Navbar Wishlist Count (assuming you have this function)
function updateWishlistNavbar() {
    // This function should be defined in your main layout
    if (typeof updateWishlistCount === 'function') {
        updateWishlistCount();
    }
}

// Add hover effect enhancement
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effect for table rows
    const rows = document.querySelectorAll('.table-row');
    rows.forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.boxShadow = '0 15px 35px rgba(0, 53, 67, 0.1)';
        });
        
        row.addEventListener('mouseleave', function() {
            this.style.boxShadow = 'none';
        });
    });
});
</script>

<%- include('../partials/user/footer') %>