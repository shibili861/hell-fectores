
<style>
    :root {
        --primary-brown: #8B4513;
        --dark-brown: #654321;
        --light-brown: #D2B48C;
        --cream: #F5F5DC;
        --light-cream: #FDF5E6;
        --accent-gold: #D4AF37;
        --text-dark: #3E2723;
        --text-light: #5D4037;
        --shadow: 0 4px 12px rgba(139, 69, 19, 0.1);
        --transition: all 0.3s ease;
        --border-radius: 8px;
    }
    
    body {
        background-color: #f9f7f3;
        color: var(--text-dark);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .dashboard-header {
        background: white;
        color: var(--text-dark);
        padding: 25px 30px;
        border-radius: var(--border-radius);
        margin-bottom: 30px;
        box-shadow: var(--shadow);
        border-left: 4px solid var(--primary-brown);
    }
    
    .dashboard-header h2 {
        font-weight: 600;
        margin: 0;
        font-size: 28px;
        color: var(--primary-brown);
    }
    
    .dashboard-header p {
        color: var(--text-light);
        margin: 5px 0 0;
    }
    
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--shadow);
        border-top: 3px solid var(--light-brown);
        transition: var(--transition);
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 16px rgba(139, 69, 19, 0.15);
    }
    
    .stat-card h3 {
        font-size: 14px;
        color: var(--text-light);
        margin: 0 0 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .stat-card .value {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary-brown);
        margin: 0;
    }
    
    .table-container {
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        margin-bottom: 30px;
    }
    
    .table-header {
        background: white;
        color: var(--text-dark);
        padding: 18px 25px;
        border-bottom: 1px solid #eae2d6;
    }
    
    .table-header h3 {
        margin: 0;
        font-weight: 600;
        font-size: 20px;
        color: var(--primary-brown);
    }
    
    .table-controls {
        display: flex;
        gap: 15px;
    }
    
    .table-controls select, .table-controls input {
        border: 1px solid var(--light-brown);
        border-radius: var(--border-radius);
        padding: 8px 12px;
        background: white;
        color: var(--text-dark);
    }
    
    .table {
        margin: 0;
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
    }
    
    .table thead th {
        background-color: #f8f4ec;
        color: var(--text-dark);
        font-weight: 600;
        padding: 15px;
        border-bottom: 2px solid var(--light-brown);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 14px;
    }
    
    .table tbody td {
        padding: 15px;
        vertical-align: middle;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .table tbody tr:hover {
        background-color: rgba(210, 180, 140, 0.08);
    }
    
    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-pending {
        background-color: #FFF3E0;
        color: #EF6C00;
    }
    
    .status-processing {
        background-color: #E3F2FD;
        color: #1565C0;
    }
    
    .status-shipped {
        background-color: #E8F5E9;
        color: #2E7D32;
    }
    
    .status-out-for-delivery {
        background-color: #F3E5F5;
        color: #7B1FA2;
    }
    
    .status-delivered {
        background-color: #E8F5E9;
        color: #2E7D32;
    }
    
    .status-cancelled {
        background-color: #FFEBEE;
        color: #C62828;
    }
    
    .btn-view {
        background-color: var(--primary-brown);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: var(--border-radius);
        font-weight: 500;
        transition: var(--transition);
    }
    
    .btn-view:hover {
        background-color: var(--dark-brown);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(139, 69, 19, 0.2);
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-light);
    }
    
    .empty-state i {
        font-size: 64px;
        color: var(--light-brown);
        margin-bottom: 20px;
    }
    
    .empty-state h3 {
        font-size: 24px;
        margin-bottom: 10px;
    }
    
    .empty-state p {
        font-size: 16px;
        max-width: 500px;
        margin: 0 auto 20px;
    }
    
    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background-color: #f8f4ec;
        border-top: 1px solid var(--light-brown);
    }
    
    .pagination-info {
        color: var(--text-light);
        font-size: 14px;
    }
    
    .pagination {
        margin: 0;
    }
    
    .page-link {
        color: var(--primary-brown);
        border: 1px solid var(--light-brown);
        padding: 8px 16px;
        border-radius: var(--border-radius);
    }
    
    .page-link:hover {
        background-color: var(--light-brown);
        color: white;
    }
    
    .page-item.active .page-link {
        background-color: var(--primary-brown);
        border-color: var(--primary-brown);
    }
    
    /* ------------------ SEARCH / FILTER BAR ------------------ */
    .filter-wrapper {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 22px;
        background: white;
        padding: 15px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
    }

    .filter-wrapper input,
    .filter-wrapper select {
        background: white;
        border: 1px solid var(--light-brown);
        border-radius: var(--border-radius);
        padding: 10px 14px;
        font-size: 15px;
        transition: var(--transition);
    }

    .filter-wrapper input:focus,
    .filter-wrapper select:focus {
        outline: none;
        border-color: var(--primary-brown);
        box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.1);
    }

    /* Search button */
    .btn-primary {
        background: var(--primary-brown);
        border: none;
        padding: 10px 18px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        transition: var(--transition);
        color: white;
    }
    
    .btn-primary:hover {
        background: var(--dark-brown);
        transform: translateY(-2px);
    }
    
    .btn-secondary {
        background: white;
        color: var(--text-dark);
        border: 1px solid var(--primary-brown);
        padding: 10px 18px;
        border-radius: var(--border-radius);
    }
    
    .btn-secondary:hover {
        background: var(--primary-brown);
        color: white;
    }

    /* ------------------ DROPDOWN STATUS COLOR ------------------ */
    form select {
        border: 1px solid var(--light-brown);
        border-radius: var(--border-radius);
        padding: 6px 10px;
        font-size: 14px;
        transition: var(--transition);
    }
    
    form select:hover {
        border-color: var(--primary-brown);
    }

    /* ------------------ PREMIUM PAGINATION ------------------ */
    .pagination {
        display: flex;
        justify-content: center;
        padding: 18px;
        gap: 8px;
    }

    .pagination .page-item .page-link {
        background: white;
        border-radius: var(--border-radius);
        border: 1px solid var(--light-brown);
        padding: 10px 18px;
        font-weight: 600;
        transition: var(--transition);
        color: var(--text-dark);
    }

    .pagination .page-item .page-link:hover {
        background: var(--primary-brown);
        color: white;
        transform: translateY(-2px);
    }

    /* ACTIVE PAGE */
    .pagination .page-item.active .page-link {
        background: var(--primary-brown);
        color: white;
        border-color: var(--primary-brown);
    }

    /* ------------------ TABLE HOVER + PREMIUM LOOK ------------------ */
    .table {
        border-radius: var(--border-radius);
        overflow: hidden;
    }

    .table tbody tr:hover {
        background: rgba(210, 180, 140, 0.08);
        transition: var(--transition);
    }

    .table thead th {
        background: #f8f4ec !important;
        color: var(--text-dark) !important;
        border: none;
    }

    /* ------------------ STATUS BADGES (already working) ------------------ */
    .status-badge {
        border-radius: 30px;
        padding: 6px 14px;
        font-weight: 600;
    }

    @media (max-width: 768px) {
        .table-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .table-controls {
            width: 100%;
            flex-wrap: wrap;
        }
        
        .stats-cards {
            grid-template-columns: 1fr;
        }
        
        .table-responsive {
            border: none;
        }
        
        .filter-wrapper {
            flex-direction: column;
        }
    }
</style>

<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
     <%- include('../partials/admin/sidebar') %>
</head>
<body>
<div class="container mt-4">
  <h2 class="mb-4">Order Management</h2>

  <% if (!orders.length) { %>
    <p>No orders found.</p>
  <% } else { %>
    <form action="/admin/orders" method="get" class="d-flex gap-2 mb-3">

  <input type="text" name="search" class="form-control"
         placeholder="Search Order ID / Email / Name"
         value="<%= search %>">

  <select name="status" class="form-select">
      <option value="">All Status</option>
      <option value="Pending" <%= status === "Pending" ? "selected" : "" %>>Pending</option>
      <option value="Shipped" <%= status === "Shipped" ? "selected" : "" %>>Shipped</option>
      <option value="Delivered" <%= status === "Delivered" ? "selected" : "" %>>Delivered</option>
      <option value="Cancelled" <%= status === "Cancelled" ? "selected" : "" %>>Cancelled</option>
  </select>

  <select name="sort" class="form-select">
      <option value="desc" <%= sort === "desc" ? "selected" : "" %>>Newest First</option>
      <option value="asc" <%= sort === "asc" ? "selected" : "" %>>Oldest First</option>
  </select>

  <button class="btn btn-primary">Apply</button>
  <a href="/admin/orders" class="btn btn-secondary">Clear</a>

</form>

    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Order ID</th>
          <th>Date</th>
          <th>User</th>
          <th>Email</th>
          <th>Status</th>
          <th>Change Status</th>
          <th>Total</th>
          <th>Action</th>
        </tr>
      </thead>
     <tbody>
  <% orders.forEach((order, index) => { %>
    <tr>
      <td><%= index + 1 %></td>
      <td><%= order.orderId %></td>
      <td><%= new Date(order.createdOn).toLocaleString() %></td>
      <td><%= order.userId ? order.userId.name : 'Guest' %></td>
      <td><%= order.userId ? order.userId.email : '-' %></td>

      <!-- STATUS DISPLAY -->
      <td>
        <span class="status-badge status-<%= order.status.toLowerCase().replace(/\s+/g, '-') %>">
          <%= order.status %>
        </span>
      </td>

      <!--  CHANGE STATUS FORM -->
      <td>
        <form class="statusForm"
              action="/admin/orders/<%= order.orderId %>/status"
              method="POST"
              style="display:flex;gap:8px;align-items:center;">

          <select name="status" class="form-select" style="padding:4px 8px;border-radius:6px;">
            <option value="Pending" <%= order.status === 'Pending' ? 'selected' : '' %>>Pending</option>
            <option value="Processing" <%= order.status === 'Processing' ? 'selected' : '' %>>Processing</option>
            <option value="Shipped" <%= order.status === 'Shipped' ? 'selected' : '' %>>Shipped</option>
            <option value="Out for Delivery" <%= order.status === 'Out for Delivery' ? 'selected' : '' %>>Out for Delivery</option>
            <option value="Delivered" <%= order.status === 'Delivered' ? 'selected' : '' %>>Delivered</option>
            <option value="Cancelled" <%= order.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
          </select>

          <button type="submit" class="btn btn-secondary btn-sm">Update</button>
        </form>
      </td>

      <td>₹<%= order.finalAmount %></td>

      <td>
        <a href="/admin/orders/<%= order.orderId %>" class="btn btn-sm btn-primary">
          View
        </a>
      </td>
    </tr>
  <% }) %>
</tbody>

    </table>

    <nav>
  <ul class="pagination justify-content-center">

    <% for (let i = 1; i <= totalPages; i++) { %>
      <li class="page-item <%= currentPage === i ? 'active' : '' %>">
        <a class="page-link"
           href="/admin/orders?page=<%= i %>&search=<%= search %>&status=<%= status %>&sort=<%= sort %>">
           <%= i %>
        </a>
      </li>
    <% } %>

  </ul>
</nav>

  <% } %>
</div>

<script>
document.querySelectorAll(".statusForm").forEach(form => {
  form.addEventListener("submit", async function(e) {
    e.preventDefault();

    const status = form.status.value;
    const statusBadge = form.closest("tr").querySelector(".status-badge"); // ✅ get status badge cell

    //  Cancel confirmation
    if (status === "Cancelled") {
      const confirmCancel = await Swal.fire({
        title: "Cancel Order?",
        text: "Once cancelled, this cannot be undone.",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes, Cancel",
        cancelButtonText: "No",
        confirmButtonColor: "#d33",
        cancelButtonColor: "#3085d6",
      });

      if (!confirmCancel.isConfirmed) return;
    }

    //  Send request without form submit
    const res = await fetch(form.action, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ status })
    });

    const data = await res.json();

    if (data.success) {
    
      statusBadge.innerText = status;
      statusBadge.className = `status-badge status-${status.toLowerCase().replace(/\s+/g, '-')}`;

      Swal.fire({
        title: "Updated!",
        text: "Order status updated successfully.",
        icon: "success",
        timer: 1500,
        showConfirmButton: false
      });
    } else {
      Swal.fire({
        title: "Error",
        text: data.message,
        icon: "error"
      });
    }
  });
});
</script>

</body>
</html>

</html>